[{"name": "app.py", "content": "import os\nimport pandas as pd\nfrom pathlib import Path\nimport plotly.express as px\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n\nfrom shiny import render\nfrom shiny import ui as shiny_ui\nfrom shiny import reactive\nfrom shiny.express import ui, render, input\n\n# Path setup for loading data relative to script\ndata_path = Path(__file__).parent / \"Xtrem_all_var_Keta_GHANA.csv\"\n#data_path=\"/home/fifi/My_GITHUBPAGES/myapp/Xtrem_all_var_Keta_GHANA.csv\"\n#station=data_path.split('/')[-1].split('_')[-1].replace('.csv', '')\n### Load and cache data\n#@reactive.calc\ndef data():\n    df = pd.read_csv(data_path)\n    df.reset_index(drop=True, inplace=True)\n    return df\n\n# Filtered data based on checkbox input\n@reactive.calc\ndef read_event():\n    df = data()\n    if df is None:\n        return pd.DataFrame()\n    return df[df[\"peak_date_time\"].isin(input.dates())].copy()\n\n\n# Page layout\nui.page_opts(window_title=\"West Africa Coast Flooding Extremes Events\",  fillable=True) #title=station,\n\nwith ui.sidebar(open=\"desktop\", bg=\"#AEAE9D\"):\n    ui.input_checkbox_group(\n        \"dates\",\n        \"Filter by Event Date\",\n        choices=data().peak_date_time.tolist(),\n        selected=data().peak_date_time.tolist(),\n        inline=False,\n    )\n    ui.input_action_button(\"reset\", \"Reset filter\")\n\nwith ui.layout_column_wrap(fill=False):\n    ui.input_select(\"var\", \"Select City\", choices=[\"Keta\"])\n\n    with ui.value_box(theme='text-red'):\n        \"TWL Threshold\"\n        @render.text\n        def thresh():\n            df = data()\n            if df is None:\n                return \"\u26a0\ufe0f File not found\"\n            return f\"{df['thresh'].iloc[0]:.2f} m\"\n\n    with ui.value_box():\n        \"Identified Extremes Events\"\n        @render.text\n        def count():\n            df = read_event()\n            if df.empty:\n                return \"\u26a0\ufe0f No data\"\n            return len(df)\n\nwith ui.layout_columns(col_widths=(7, 5)):\n    with ui.card():\n        ui.card_header(\"Hs vs Tide\")\n        with ui.layout_columns(col_widths=(12, 12)):\n            with ui.card(full_screen=True):\n\n                @render.plot\n                def bivariate():\n                    df = read_event()\n                    if df.empty:\n                        fig, ax = plt.subplots()\n                        ax.text(0.5, 0.5, \"No data available\", ha=\"center\")\n                        return fig\n                    \n                    # continue plotting...\n                    fig, ax = plt.subplots(figsize=(10, 6))\n                    scatter = ax.scatter(\"Tide_10min\",\"Significant_Wave_Height\",\n                        c=\"peak_value\",\n                        s=\"duration_hours\",\n                        data=df,\n                        cmap='viridis',\n                        alpha=0.7,\n                        )\n                    legend1 = ax.legend(*scatter.legend_elements(),loc=\"lower left\", title=\"Peak value\")\n                    ax.add_artist(legend1)\n                    handles, labels = scatter.legend_elements(prop=\"sizes\", alpha=0.6)\n                    legend2 = ax.legend(handles, labels, loc=\"upper right\", title=\"Duration\")\n                    #ax.set_title(\"Significant Wave Height vs Tide\")\n                    ax.set_xlabel(\"Tide [m]\")\n                    ax.set_ylabel(\"Hs [m]\")\n                    fig.tight_layout()\n                    return fig\n\n            with ui.card(full_screen=True):\n                ui.card_header(\"Variable contributions\")\n\n                @render.plot\n                def contrib():\n                    df = read_event()\n                    if df.empty:\n                        fig, ax = plt.subplots()\n                        ax.text(0.5, 0.5, \"No data available\", ha=\"center\")\n                        return fig\n                    # continue plotting...\n                    contrib_df = df[[\"SSH_10min\", \"Tide_10min\", \"Wave_Runup\"]].div(df[\"peak_value\"], axis=0)\n                    contrib_df[\"Event\"] = df[\"peak_date_time\"]\n\n                    melted = contrib_df.melt(id_vars=\"Event\", var_name=\"Variable\", value_name=\"Contribution\")\n                    \n                    fig, ax = plt.subplots(figsize=(12, 6))\n                    sns.barplot(\n                        data=melted,\n                        x=\"Event\",\n                        y=\"Contribution\",\n                        hue=\"Variable\",\n                        ax=ax\n                        )\n                    ax.set_xticklabels(ax.get_xticklabels(), rotation=30)\n                    fig.autofmt_xdate()\n                    #ax.set_title(\"Variable Contributions to Peak\")\n                    ax.set_ylabel(\"Relative Contribution\")\n                    fig.tight_layout()\n                    \n                    return fig\n\n    with ui.card():\n        ui.card_header(\"Extremes Events Table\")\n\n        @render.data_frame\n        def table():\n            df = read_event()\n            if df.empty:\n                return render.DataGrid(pd.DataFrame({\"Message\": [\"No data available\"]}))\n            # show real table\n            cols = [\n                'peak_date_time',\n                'peak_value',\n                'SSH_10min',\n                'Tide_10min',\n                'Significant_Wave_Height',\n                'duration_hours'\n            ]\n            return render.DataGrid(\n                read_event()[cols].round(3),\n                filters=False,\n                summary=True,\n                styles=[\n                    {\"cols\": [1], \"style\": {\"background-color\": \"#c8c1cde8\"}},\n                ]\n            )\n\n# Reset checkbox selection\n@reactive.effect\n@reactive.event(input.reset)\ndef _():\n    ui.update_checkbox_group(\"dates\", selected=data().peak_date_time.tolist())\n\n@reactive.effect\ndef warn_if_file_missing():\n    if data() is None:\n        shiny_ui.notification_show(\"\u26a0\ufe0f Data file not found!\", type=\"warning\")", "type": "text"}, {"name": "Xtrem_all_var_Keta_GHANA.csv", "content": "peak_date_time,peak_value,total_above,start_date_time,end_date_time,duration_days,duration_hours,thresh,total_water_level,exceedance probability,return period,SSH_10min,Tide_10min,Significant_Wave_Height,Peak_Wave_Period,Wave_Setup,Wave_Runup,slope,elevation,Wave_orientation\n1994-02-28 17:40:00,1.917880329017891,12,1994-02-28 16:40:00,1994-02-28 18:30:00,0 days 01:50:00,1.8333333333333333,1.8,1.917880329017891,0.14285714285714285,8.383055780827275,-0.0094607379287481,0.9111175296879944,1.04,20.87,0.0786484649006501,1.0162235372586446,0.00844964606297,-44.0,51.660936764501685\n1994-03-26 15:10:00,1.809129292207253,3,1994-03-26 15:00:00,1994-03-26 15:20:00,0 days 00:20:00,0.3333333333333333,1.8,1.809129292207253,0.9285714285714286,1.2897008893580424,-0.0094607379287481,0.8840844712659628,1.31,17.1,0.0723240753156718,0.9345055588700384,0.00844964606297,-44.0,51.660936764501685\n1996-06-01 15:20:00,1.8347590894807893,6,1996-06-01 15:00:00,1996-06-01 15:50:00,0 days 00:50:00,0.8333333333333334,1.8,1.8347590894807893,0.6071428571428571,1.9724837131358297,-0.0708029419183731,0.7992889292762001,1.55,18.61,0.0856176599467078,1.1062731021229626,0.00844964606297,-44.0,51.660936764501685\n1997-09-19 05:20:00,1.8352517627947569,7,1997-09-19 04:50:00,1997-09-19 05:50:00,0 days 01:00:00,1.0,1.8,1.8352517627947569,0.5714285714285714,2.095763945206819,0.0201422162353992,0.9012129949461248,1.18,17.62,0.0707290849179424,0.9138965516132328,0.00844964606297,-44.0,51.660936764501685\n1998-10-07 04:30:00,1.8264564549827869,6,1998-10-07 04:00:00,1998-10-07 04:50:00,0 days 00:50:00,0.8333333333333334,1.8,1.8264564549827869,0.7142857142857143,1.676611156165455,0.0665303505957126,0.9566473670008028,1.01,16.740000000000002,0.0621680538449123,0.8032787373862713,0.00844964606297,-44.0,51.660936764501685\n2001-05-06 15:10:00,1.8248819119658544,7,2001-05-06 14:40:00,2001-05-06 15:40:00,0 days 01:00:00,1.0,1.8,1.8248819119658544,0.75,1.5967725296813857,-0.0051881466060876,0.8067799909057563,1.37,18.31,0.0791953640309597,1.023290067666186,0.00844964606297,-44.0,51.660936764501685\n2001-09-18 16:30:00,1.8285038997223757,7,2001-09-18 16:00:00,2001-09-18 17:00:00,0 days 01:00:00,1.0,1.8,1.8285038997223757,0.6785714285714286,1.7648538485952159,-0.0595110934227705,0.794452903574604,1.65,17.830000000000002,0.0846339180947157,1.0935620895705418,0.00844964606297,-44.0,51.660936764501685\n2010-08-12 06:00:00,1.856376185823568,2,2010-08-12 06:00:00,2010-08-12 06:10:00,0 days 00:10:00,0.16666666666666666,1.8,1.856376185823568,0.39285714285714285,3.0483839203008274,-0.0735496077686548,0.8706739326947411,1.46,18.36,0.0819785507305571,1.0592518608974817,0.00844964606297,-44.0,51.660936764501685\n2010-10-25 04:20:00,1.8031710410167705,2,2010-10-25 04:20:00,2010-10-25 04:30:00,0 days 00:10:00,0.16666666666666666,1.8,1.8031710410167705,0.9642857142857143,1.241934189752189,0.1211584825068712,0.6449331482038337,1.56,17.39,0.0802625609525555,1.0370794103060652,0.00844964606297,-44.0,51.660936764501685\n2011-10-26 03:00:00,1.815391535659427,2,2011-10-26 03:00:00,2011-10-26 03:10:00,0 days 00:10:00,0.16666666666666666,1.8,1.815391535659427,0.8214285714285714,1.4579227444917002,0.1467940304428339,0.900755438851927,1.39,13.64,0.0594255078647662,0.767842066364666,0.00844964606297,-44.0,51.660936764501685\n2012-08-18 04:10:00,1.901679493126493,13,2012-08-18 03:10:00,2012-08-18 05:10:00,0 days 02:00:00,2.0,1.8,1.901679493126493,0.21428571428571427,5.588703853884851,-0.0390636920928955,0.70507710519738,2.23,17.330000000000002,0.0956317549834513,1.2356660800220085,0.00844964606297,-44.0,51.660936764501685\n2013-09-21 04:40:00,1.9825142093385024,16,2013-09-21 03:20:00,2013-09-21 05:50:00,0 days 02:30:00,2.5,1.8,1.9825142093385024,0.07142857142857142,16.76611156165455,-0.0161748100072145,0.7809362487958132,1.61,20.1,0.0942453923972512,1.217752770549904,0.00844964606297,-44.0,51.660936764501685\n2015-09-29 04:20:00,1.8332752475123848,7,2015-09-29 03:50:00,2015-09-29 04:50:00,0 days 01:00:00,1.0,1.8,1.8332752475123848,0.6428571428571429,1.8629012846282833,0.0100711081176996,0.9635892346677012,1.3,15.79,0.0665280720075359,0.8596149047269845,0.00844964606297,-44.0,51.660936764501685\n2015-11-25 02:50:00,1.8437449601523817,8,2015-11-25 02:10:00,2015-11-25 03:20:00,0 days 01:10:00,1.1666666666666667,1.8,1.8437449601523817,0.4642857142857143,2.579401778716085,0.073244422674179,0.8388567830992609,1.65,15.19,0.0721025920279714,0.9316437543789416,0.00844964606297,-44.0,51.660936764501685\n2016-04-24 17:00:00,1.815386389080079,7,2016-04-23 16:30:00,2016-04-24 17:20:00,1 days 00:50:00,24.833333333333332,1.8,1.815386389080079,0.8571428571428571,1.3971759634712126,0.0305185094475746,0.6177808146704746,1.56,19.57,0.0903242275929563,1.1670870649620295,0.00844964606297,-44.0,51.660936764501685\n2016-09-04 05:30:00,1.9037822770726869,13,2016-09-04 04:20:00,2016-09-04 06:20:00,0 days 02:00:00,2.0,1.8,1.9037822770726869,0.17857142857142858,6.70644462466182,0.0061037018895149,0.6308407048356907,1.95,19.0,0.0980442295694236,1.2668378703474812,0.00844964606297,-44.0,51.660936764501685\n2017-06-11 16:40:00,1.9258162792720648,34,2017-06-10 15:20:00,2017-06-11 17:50:00,1 days 02:30:00,26.5,1.8,1.9258162792720648,0.10714285714285714,11.177407707769701,0.016785180196166,0.5602130992933169,2.53,17.76,0.1043889077785313,1.3488179997825822,0.00844964606297,-44.0,51.660936764501685\n2018-09-26 04:20:00,1.855234504229876,17,2018-09-25 15:20:00,2018-09-26 05:00:00,0 days 13:40:00,13.666666666666666,1.8,1.855234504229876,0.42857142857142855,2.7943519269424253,0.0378429517149925,0.7108698138106416,1.78,17.37,0.0856369026474708,1.106521738704242,0.00844964606297,-44.0,51.660936764501685\n2019-08-31 04:20:00,1.8136266229841715,4,2019-08-31 04:10:00,2019-08-31 04:40:00,0 days 00:30:00,0.5,1.8,1.8136266229841715,0.8928571428571429,1.341288924932364,-0.0369273964315652,0.8852452237064468,1.35,17.400000000000002,0.0747080264864089,0.96530879570929,0.00844964606297,-44.0,51.660936764501685\n2021-11-02 01:40:00,1.8709809087177427,12,2021-11-02 00:40:00,2021-11-02 02:30:00,0 days 01:50:00,1.8333333333333333,1.8,1.8709809087177427,0.35714285714285715,3.35322231233091,0.1260414440184831,0.6762999336886039,1.27,19.86,0.0827050895444351,1.0686395310106558,0.00844964606297,-44.0,51.660936764501685\n2021-11-06 04:10:00,2.071666047638163,58,2021-11-05 15:00:00,2021-11-07 06:00:00,1 days 15:00:00,39.0,1.8,2.071666047638163,0.03571428571428571,33.5322231233091,0.1696829125285148,0.88724187146352,1.08,20.45,0.0785337474788301,1.0147412636461284,0.00844964606297,-44.0,51.660936764501685\n2022-04-02 16:50:00,1.8426832395661463,16,2022-04-02 16:10:00,2022-04-03 17:50:00,1 days 01:40:00,25.666666666666668,1.8,1.8426832395661463,0.5357142857142857,2.2354815415539404,0.015564439818263,0.7525966235978437,1.7,17.26,0.0831603643858503,1.0745221761500396,0.00844964606297,-44.0,51.660936764501685\n2023-04-17 14:10:00,1.874953989505216,11,2023-04-17 13:20:00,2023-04-17 15:00:00,0 days 01:40:00,1.6666666666666667,1.8,1.874953989505216,0.2857142857142857,4.191527890413638,0.1498458813875913,0.7484813463933842,1.27,18.15,0.0755839564567723,0.97662676172424,0.00844964606297,-44.0,51.660936764501685\n2023-09-14 15:30:00,1.8434892641742768,14,2023-09-14 03:10:00,2023-09-14 16:10:00,0 days 13:00:00,13.0,1.8,1.8434892641742768,0.5,2.3951587945220787,0.0195318460464477,0.5599672822675894,2.48,16.81,0.0978238351998242,1.2639901358602394,0.00844964606297,-44.0,51.660936764501685\n2023-09-20 05:50:00,1.824147329048688,8,2023-09-20 05:40:00,2023-09-20 06:50:00,0 days 01:10:00,1.1666666666666667,1.8,1.824147329048688,0.7857142857142857,1.5241919601504137,0.0704977568238973,0.5538195213861706,1.74,19.05,0.0928583015255522,1.19983005083862,0.00844964606297,-44.0,51.660936764501685\n2024-03-10 16:10:00,1.8729045373932087,20,2024-03-10 15:30:00,2024-03-11 17:40:00,1 days 02:10:00,26.166666666666668,1.8,1.8729045373932087,0.32142857142857145,3.7258025692565666,0.0634784996509552,0.9617748006521882,0.91,18.61,0.0656021693298992,0.8476512370900657,0.00844964606297,-44.0,51.660936764501685\n2024-10-17 02:50:00,1.8772381594122989,30,2024-10-15 01:00:00,2024-10-17 04:00:00,2 days 03:00:00,51.0,1.8,1.8772381594122989,0.25,4.790317589044157,0.1437421794980764,0.9450302197865912,1.36,14.16,0.0610216348934846,0.788465760127631,0.00844964606297,-44.0,51.660936764501685\n", "type": "text"}]